<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Solar System</title>
  <style>
    body { background: #000; color: #fff; text-align: center; font-family: sans-serif; }
    canvas { background: #000; display: block; margin: 0 auto; }
    .emotionBarContainer {
      width: 300px;
      height: 20px;
      border: 1px solid #fff;
      margin: 20px auto;
    }
    .emotionBar {
      height: 100%;
      width: 0%;
    }
    #positiveEmotionBar {
      background: #32cd32;
    }
    #negativeEmotionBar {
      background: #dc143c;
    }
  </style>
</head>
<body>
  <h1>Solar System</h1>
  <canvas id="solarSystem" width="600" height="600"></canvas>
  <div>Positive Emotion Level: <span id="positiveEmotionValue">0</span>%</div>
  <div id="positiveEmotionBarContainer" class="emotionBarContainer"><div id="positiveEmotionBar" class="emotionBar"></div></div>
  <div>Negative Emotion Level: <span id="negativeEmotionValue">0</span>%</div>
  <div id="negativeEmotionBarContainer" class="emotionBarContainer"><div id="negativeEmotionBar" class="emotionBar"></div></div>
  <script>
    const canvas = document.getElementById('solarSystem');
    const ctx = canvas.getContext('2d');
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    const positiveEmotionValue = document.getElementById('positiveEmotionValue');
    const positiveEmotionBar = document.getElementById('positiveEmotionBar');
    const negativeEmotionValue = document.getElementById('negativeEmotionValue');
    const negativeEmotionBar = document.getElementById('negativeEmotionBar');

    const maxDistance = 220;
    const maxSemiMajorAxis = 30.05; // Neptune's semi-major axis in AU
    const logMax = Math.log(maxSemiMajorAxis + 1);
    const maxPlanetRadius = 69911; // Jupiter radius in km
    const maxDisplayRadius = 12; // Jupiter display radius in px
    const timeScale = 0.05; // animation speed factor

    const planetData = [
      { name: 'Mercury', color: '#a9a9a9', radius: 2440, distance: 0.39, period: 88 },
      { name: 'Venus', color: '#f5deb3', radius: 6052, distance: 0.72, period: 225 },
      { name: 'Earth', color: '#1e90ff', radius: 6371, distance: 1.0, period: 365 },
      { name: 'Mars', color: '#ff4500', radius: 3390, distance: 1.52, period: 687 },
      { name: 'Jupiter', color: '#ffa500', radius: 69911, distance: 5.2, period: 4333 },
      { name: 'Saturn', color: '#daa520', radius: 58232, distance: 9.58, period: 10759, hasRings: true },
      { name: 'Uranus', color: '#7fffd4', radius: 25362, distance: 19.2, period: 30688 },
      { name: 'Neptune', color: '#4169e1', radius: 24622, distance: 30.05, period: 60182 }
    ];

    const sun = {
      radius: Math.cbrt(695700) / Math.cbrt(maxPlanetRadius) * maxDisplayRadius,
      color: 'yellow'
    };

    let earth;
    const planets = planetData
      .map(p => {
        const distance = Math.log(p.distance + 1) / logMax * maxDistance + 20;
        const radius = Math.cbrt(p.radius) / Math.cbrt(maxPlanetRadius) * maxDisplayRadius;
        const speed = (2 * Math.PI) / p.period * timeScale;
        return { ...p, distance, radius, speed, angle: Math.random() * Math.PI * 2 };
      })
      .filter(p => {
        if (p.name === 'Earth') {
          earth = p;
          return false;
        }
        return true;
      });

    // generate background stars
    const stars = Array.from({ length: 100 }, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      radius: Math.random() * 1.5 + 0.5
    }));

    const positiveAngles = [0, Math.PI / 3, (2 * Math.PI) / 3]; // conjunction, sextile, trine
    const negativeAngles = [Math.PI / 2, Math.PI]; // square, opposition
    const aspectTolerance = (5 * Math.PI) / 180; // 5 degrees in radians

    function angleDifference(a, b) {
      let diff = Math.abs(a - b) % (2 * Math.PI);
      return diff > Math.PI ? 2 * Math.PI - diff : diff;
    }

    function aspectIntensity(diff, angles) {
      const minDiff = Math.min(...angles.map(a => Math.abs(diff - a)));
      return Math.max(0, 1 - minDiff / aspectTolerance);
    }

    function drawStars() {
      ctx.fillStyle = '#fff';
      stars.forEach(s => {
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.radius, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // draw distant stars
      drawStars();

      // update Earth's position
      earth.angle += earth.speed;
      const earthX = Math.cos(earth.angle) * earth.distance;
      const earthY = Math.sin(earth.angle) * earth.distance;

      // draw the sun relative to Earth
      const sunX = cx - earthX;
      const sunY = cy - earthY;
      ctx.fillStyle = sun.color;
      ctx.beginPath();
      ctx.arc(sunX, sunY, sun.radius, 0, Math.PI * 2);
      ctx.fill();

      ctx.font = '10px sans-serif';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'middle';

      // draw Earth at the center
      ctx.fillStyle = earth.color;
      ctx.beginPath();
      ctx.arc(cx, cy, earth.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#fff';
      ctx.fillText('Earth', cx + earth.radius + 2, cy);

      // draw planets relative to Earth
      let positiveEmotion = 0;
      let negativeEmotion = 0;
      planets.forEach(p => {
        p.angle += p.speed;
        const px = Math.cos(p.angle) * p.distance;
        const py = Math.sin(p.angle) * p.distance;
        const x = cx + (px - earthX);
        const y = cy + (py - earthY);
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(x, y, p.radius, 0, Math.PI * 2);
        ctx.fill();

        if (p.hasRings) {
          ctx.strokeStyle = 'rgba(218,165,32,0.6)';
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.ellipse(x, y, p.radius * 2, p.radius * 0.7, 0, 0, Math.PI * 2);
          ctx.stroke();
        }

        ctx.fillStyle = '#fff';
        ctx.fillText(p.name, x + p.radius + 2, y);

        const diff = angleDifference(p.angle, earth.angle);
        positiveEmotion += aspectIntensity(diff, positiveAngles);
        negativeEmotion += aspectIntensity(diff, negativeAngles);
      });
      const positiveLevel = (positiveEmotion / planets.length) * 100;
      const negativeLevel = (negativeEmotion / planets.length) * 100;
      positiveEmotionBar.style.width = positiveLevel + '%';
      positiveEmotionValue.textContent = positiveLevel.toFixed(0);
      negativeEmotionBar.style.width = negativeLevel + '%';
      negativeEmotionValue.textContent = negativeLevel.toFixed(0);

      requestAnimationFrame(draw);
    }
    draw();
  </script>
</body>
</html>
